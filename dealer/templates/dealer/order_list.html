{% extends 'base.html' %} {% block content %}
<div class="container-fluid px-4 py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-0">Your Order History</h2>
      <p class="text-muted mb-0">Track and manage your paddy purchases</p>
    </div>
    <div>
      <button class="btn btn-outline-primary">
        <i class="fas fa-download me-2"></i>Export
      </button>
    </div>
  </div>

  {% if orders %}
  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th class="ps-4">Manager</th>
              <th>Product</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Status</th>
              <th>Date</th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr class="align-middle">
              <td class="ps-4">
                <div class="d-flex align-items-center">
                  <div
                    class="avatar avatar-sm bg-light-primary rounded-circle me-"
                  >
                    <span>{{ order.manager}}</span>
                    {% comment %} <span>shanto</span> {% endcomment %}
                  </div>
                  <div>
                    <h6 class="mb-0">{{ order.manager.user.get_full_name }}</h6>
                    <small class="text-muted">{{ order.manager.union }}</small>
                  </div>
                </div>
              </td>
              <td>
                <div class="d-flex align-items-center">
                  {% if order.paddy.image %}
                  <img
                    src="{{ order.paddy.image.url }}"
                    alt="{{ order.paddy.name }}"
                    class="rounded me-3"
                    width="40"
                    height="40"
                  />
                  {% else %}
                  <div class="bg-light rounded me-3 p-2">
                    <i class="fas fa-seedling text-success"></i>
                  </div>
                  {% endif %}
                  <div>
                    <h6 class="mb-0">{{ order.paddy.name }}</h6>
                    <small class="text-muted"
                      >Moisture: {{ order.paddy.moisture_content }}%</small
                    >
                  </div>
                </div>
              </td>
              <td>{{ order.quantity_purchased }} {{ order.paddy.unit }}</td>
              <td>
                <div class="d-flex flex-column">
                  <span class="fw-bold">৳{{ order.total_price }}</span>
                  <small class="text-muted"
                    >৳{{ order.transport_cost }} transport</small
                  >
                </div>
              </td>
              <td>
                <span
                  class="badge rounded-pill {% if order.is_confirmed and order.payment %}bg-success {% elif order.is_confirmed %}bg-primary {% else %}bg-warning{% endif %}"
                >
                  {% if order.is_confirmed and order.payment %}
                  <i class="fas fa-check-circle me-1"></i> Completed {% elif
                  order.is_confirmed %}
                  <i class="fas fa-clock me-1"></i> Processing {% else %}
                  <i class="fas fa-hourglass-half me-1"></i> Pending {% endif %}
                </span>
              </td>
              <td>
                <div class="d-flex flex-column">
                  <span>{{ order.purchase_date|date:"M d, Y" }}</span>
                  <small class="text-muted"
                    >{{ order.purchase_date|date:"h:i A" }}</small
                  >
                </div>
              </td>
              <td class="text-end pe-4">
                <div class="dropdown">
                  <button
                    class="btn btn-sm btn-outline-secondary dropdown-toggle"
                    type="button"
                    id="orderActions"
                    data-bs-toggle="dropdown"
                  >
                    <i class="fas fa-ellipsis-h"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="fas fa-file-invoice me-2"></i>View Details
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="fas fa-receipt me-2"></i>Get Invoice
                      </a>
                    </li>
                    {% if not order.is_confirmed %}
                    <li>
                      <a class="dropdown-item text-danger" href="#">
                        <i class="fas fa-times-circle me-2"></i>Cancel Order
                      </a>
                    </li>
                    {% endif %}
                  </ul>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div class="text-muted">
      Showing <span class="fw-bold">{{ orders|length }}</span> of
      <span class="fw-bold">{{ orders|length }}</span> orders
    </div>
    <nav aria-label="Page navigation">
      <ul class="pagination pagination-sm">
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1">Previous</a>
        </li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
          <a class="page-link" href="#">Next</a>
        </li>
      </ul>
    </nav>
  </div>
  {% else %}
  <div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
      <div class="empty-state">
        {% comment %}
        <img
          src="{% static 'images/empty-order.svg' %}"
          alt="No orders"
          width="200"
          class="mb-4"
        />
        {% endcomment %}
        <h4 class="mb-3">No Orders Found</h4>
        <p class="text-muted mb-4">
          You haven't placed any orders yet. When you do, they'll appear here.
        </p>
        <a href="{% url 'marketplace_paddy_posts' %}" class="btn btn-primary">
          <i class="fas fa-seedling me-2"></i>Browse Paddy Stocks
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
  .avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .avatar span {
    line-height: 1;
  }

  .bg-light-primary {
    background-color: #e3f2fd;
    color: #1976d2;
  }

  .table-hover tbody tr {
    transition: all 0.2s ease;
  }

  .table-hover tbody tr:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }

  .empty-state {
    max-width: 400px;
    margin: 0 auto;
  }

  .badge {
    padding: 0.35em 0.65em;
    font-weight: 500;
  }

  .dropdown-toggle::after {
    display: none;
  }
</style>
{% endblock %}
